- ruleID: "spring-framework-unsupported-version"
  category: "mandatory"
  effort: 1
  labels:
    - "konveyor.io/source=spring-framework"
    - "konveyor.io/target=spring-framework-6.0+"
  when:
    or:
      - builtin.xml:
          filepaths:
            - pom.xml
          namespaces:
            m: "http://maven.apache.org/POM/4.0.0"
          xpath: >
            //m:project/m:dependencies/m:dependency[
              m:groupId='org.springframework'
              and starts-with(m:artifactId, 'spring-')
              and not(contains(m:version, '${'))
              and number(substring-before(m:version, '.')) < 5
            ]

      - and:
          - builtin.xml:
              filepaths:
                - pom.xml
              namespaces:
                m: "http://maven.apache.org/POM/4.0.0"
              xpath: >
                //m:project/m:dependencies/m:dependency[
                  m:groupId='org.springframework'
                  and starts-with(m:artifactId, 'spring-')
                  and contains(m:version, '${spring.version}')
                ]
          - builtin.xml:
              filepaths:
                - pom.xml
              namespaces:
                m: "http://maven.apache.org/POM/4.0.0"
              xpath: >
                //m:project/m:properties/m:spring.version[
                  not(contains(text(), '${'))
                  and number(substring-before(text(), '.')) < 5
                ]
  description: "Detects unsupported Spring Framework versions (< 5.x)"
  message: |
    Spring Framework version is below 5.0.0, which is unsupported.
    Please upgrade to a supported release (6.0.x or above).
  links:
    - title: "Spring Framework Releases"
      url: "https://github.com/spring-projects/spring-framework/releases"
