- ruleID: "spring-framework-unsupported-version"
  category: "mandatory"
  effort: 1
  labels:
    - "cto.io/source=spring-framework"
    - "cto.io/source=spring-framework-before-6.0"
    - "cto.io/source=gradle"
    - "cto.io/source=spring-framework-deprecated"
  when:
    or:
      - builtin.filecontent:
          filePattern: build.gradle
          pattern: implementation\s*\(['"]org\.springframework:spring-.*:([1-5]\.\d+|\d)\.?\d*['"]\) # Match Spring Framework version < 6.0 in build.gradle

      - builtin.filecontent:
          filePattern: build.gradle.kts
          pattern: implementation\(["']org\.springframework:spring-.*:([1-5]\.\d+|\d)\.?\d*["']\) # Match Spring Framework version < 6.0 in build.gradle.kts

      - and:
          - builtin.filecontent:
              filePattern: build.gradle
              pattern: implementation\s*\(['"]org\.springframework:spring-.*:\$springFrameworkVersion['"]\) # Match dependency using property in build.gradle
          - builtin.filecontent:
              filePattern: gradle.properties
              pattern: springFrameworkVersion\s*=\s*([1-5]\.\d+|\d)\.?\d* # Match property value < 6.0 in gradle.properties

      - and:
          - builtin.filecontent:
              filePattern: build.gradle.kts
              pattern: implementation\(["']org\.springframework:spring-.*:\$springFrameworkVersion["']\) # Match dependency using property in build.gradle.kts
          - builtin.filecontent:
              filePattern: gradle.properties
              pattern: springFrameworkVersion\s*=\s*([1-5]\.\d+|\d)\.?\d* # Match property value < 6.0 in gradle.properties

  description: "Spring Framework version is older than 6.0 in Gradle projects and is unsupported."
  message: |
    Detected Spring Framework version older than 6.0, which is unsupported. Upgrade to 6.2 or later for active support.
  links:
    - title: "Spring Framework End of Life Policy"
      url: "https://spring.io/projects/spring-framework#support"
