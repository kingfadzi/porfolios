# Base PostgreSQL Dockerfile
FROM almalinux:8

# Set environment variables
ENV POSTGRES_VERSION=13
ENV PGDATA=/var/lib/pgsql/data

# Install PostgreSQL and dependencies
RUN dnf -y update && \
    dnf -y install \
        dnf-plugins-core && \
    dnf -y module enable postgresql:$POSTGRES_VERSION && \
    dnf -y install \
        postgresql-server \
        postgresql-contrib && \
    dnf clean all

# Create the data directory and initialize the database
RUN mkdir -p $PGDATA && \
    chown -R postgres:postgres $PGDATA && \
    su - postgres -c "initdb -D $PGDATA"

# Expose PostgreSQL port
EXPOSE 5432

# Set the default user to "postgres"
USER postgres

# Command to start PostgreSQL
CMD ["postgres", "-D", "/var/lib/pgsql/data"]
