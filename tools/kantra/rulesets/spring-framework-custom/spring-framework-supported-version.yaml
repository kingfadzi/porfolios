- ruleID: "spring-framework-supported-version"
  category: "informational"
  effort: 1
  labels:
    - "konveyor.io/source=spring-framework"
    - "konveyor.io/target=spring-framework-6.0+"
  when:
    or:
      # CASE A: Direct numeric version (>= 6)
      - builtin.xml:
          filepaths:
            - pom.xml
          namespaces:
            m: "http://maven.apache.org/POM/4.0.0"
          xpath: >
            //m:project/m:dependencies/m:dependency[
              m:groupId='org.springframework'
              and starts-with(m:artifactId, 'spring-')
              and not(contains(m:version, '${'))
              and number(substring-before(m:version, '.')) >= 6
            ]

      # CASE B: Property reference + property (>= 6)
      - and:
          - builtin.xml:
              filepaths:
                - pom.xml
              namespaces:
                m: "http://maven.apache.org/POM/4.0.0"
              xpath: >
                //m:project/m:dependencies/m:dependency[
                  m:groupId='org.springframework'
                  and starts-with(m:artifactId, 'spring-')
                  and contains(m:version, '${spring.version}')
                ]
          - builtin.xml:
              filepaths:
                - pom.xml
              namespaces:
                m: "http://maven.apache.org/POM/4.0.0"
              xpath: >
                //m:project/m:properties/m:spring.version[
                  not(contains(text(), '${'))
                  and number(substring-before(text(), '.')) >= 6
                ]
  description: "Detects supported Spring Framework versions (>= 6.0.0)"
  message: |
    Spring Framework version is 6.0.0 or newer and currently supported.
    No action neededâ€”your Spring Framework version is up to date.
  links:
    - title: "Spring 6.0 Current Branch"
      url: "https://github.com/spring-projects/spring-framework"
